# 我想要做一個可以把Youtube影片下載成MP3的工具

## 使用者故事
作為一個音樂愛好者，
我想要有一個簡單易用的桌面應用程式，
讓我可以將我喜愛的Youtube影片轉換並下載成MP3格式，
以便我能夠在沒有網路連接的情況下也能享受音樂。

## 接受標準

### 基本功能
1. ✅ 使用者可以輸入Youtube影片的URL（支援 `youtube.com` 和 `youtu.be` 格式）。
2. ✅ 工具能夠將影片轉換成高品質的MP3格式（預設 192kbps）。
3. ✅ 提供音質選項：128kbps（標準）、192kbps（高）、320kbps（極高）。
4. ✅ 下載完成後，MP3檔案會自動儲存在使用者指定的資料夾中。
5. ✅ 使用者可以透過「選擇資料夾」按鈕選擇儲存位置，預設為 `~/Downloads`。

### 使用者介面
6. ✅ 提供使用者友好的圖形介面（GUI），使用 Flet 框架建構。
7. ✅ 顯示下載進度條，包含百分比與下載速度。
8. ✅ 下載完成後顯示成功提示（SnackBar 通知）。
9. ✅ 輸入錯誤時顯示錯誤訊息（如：非 YouTube 網址）。
10. ✅ 視窗大小適中（650x580），所有元素皆可見。

### 跨平台支援
11. ✅ 支援 macOS（已測試，可打包為 `.app`）。
12. ⬜ 支援 Windows（理論支援，需測試打包為 `.exe`）。
13. ⬜ 支援 Linux（理論支援，需測試）。

### 技術需求
14. ✅ 啟動時自動偵測 FFmpeg，若未安裝則顯示安裝指引。
15. ✅ 使用 yt-dlp 作為下載核心，需保持最新版本以相容 YouTube API 變更。
16. ✅ 需使用 Python 3.8+ 環境（建議 3.12）。

## 非功能性需求
- **效能**：下載速度取決於網路環境，轉檔過程應在數秒內完成。
- **穩定性**：處理 YouTube API 變更，使用 `player_client: ['ios', 'android']` 避免 HTTP 400 錯誤。
- **可維護性**：程式碼模組化，GUI、下載邏輯、工具函式分離。

## 其他備註（未來功能）
- ⬜ 批次下載功能：讓使用者能夠一次輸入多個網址下載。
- ⬜ 播放清單支援：支援下載整個 YouTube 播放清單。
- ⬜ 下載歷史紀錄：記錄已下載的影片，避免重複下載。
- ⬜ 自動更新 yt-dlp：定期檢查並更新 yt-dlp 版本。
- ⬜ 多語言介面：支援英文/繁體中文切換。

## 技術架構

### 檔案結構
```
src/
├── main.py          # 主 GUI 程式，Flet 介面
├── downloader.py    # YoutubeDownloader 類別，下載/轉檔邏輯
└── utils.py         # FFmpeg 檢查與安裝指引
build.py             # PyInstaller 打包腳本
requirements.txt     # 相依套件：yt-dlp, flet, pillow, pyinstaller
```

### 關鍵技術決策
| 決策 | 選擇 | 原因 |
|------|------|------|
| GUI 框架 | Flet 0.25.x | 跨平台、Python 原生、簡潔 API |
| 下載工具 | yt-dlp | youtube-dl 分支，維護更積極 |
| 音訊處理 | FFmpeg | 業界標準，支援多種格式 |
| 打包工具 | PyInstaller | 可產生獨立執行檔 |

### 已知限制
- Flet 0.28+ 在 macOS 上 FilePicker 有問題，需使用 0.25.x。
- yt-dlp 需定期更新以跟上 YouTube API 變更。
- 部分影片可能因版權限制無法下載。

## 測試案例

| 測試項目 | 預期結果 | 狀態 |
|----------|----------|------|
| 輸入有效 YouTube URL | 成功下載 MP3 | ✅ |
| 輸入無效 URL | 顯示錯誤訊息 | ✅ |
| 選擇儲存資料夾 | 資料夾路徑更新 | ✅ |
| 切換音質選項 | 按選擇的音質下載 | ✅ |
| 下載進度顯示 | 顯示百分比與速度 | ✅ |
| 打包後執行 | 功能正常 | ✅ |